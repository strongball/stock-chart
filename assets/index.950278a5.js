var K=Object.defineProperty,Z=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var E=(r,o,t)=>o in r?K(r,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[o]=t,v=(r,o)=>{for(var t in o||(o={}))X.call(o,t)&&E(r,t,o[t]);if(R)for(var t of R(o))$.call(o,t)&&E(r,t,o[t]);return r},A=(r,o)=>Z(r,_(o));var j=(r,o)=>{var t={};for(var e in r)X.call(r,e)&&o.indexOf(e)<0&&(t[e]=r[e]);if(r!=null&&R)for(var e of R(r))o.indexOf(e)<0&&$.call(r,e)&&(t[e]=r[e]);return t};import{a as U,r as h,j as C,G as B,b as c,T as J,B as Q,R as N,c as G,d as F,n as ee,u as te,C as ne,e as oe,f as O}from"./vendor.ffc94ebc.js";const re=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&e(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}};re();async function se(r){const t=(await U.request({method:"GET",url:"https://alpha-vantage.p.rapidapi.com/query",params:{function:"TIME_SERIES_DAILY",symbol:r,outputsize:"compact",datatype:"json"},headers:{"x-rapidapi-host":"alpha-vantage.p.rapidapi.com","x-rapidapi-key":"25736f6270msh628d56ffab28607p1deb15jsnf857454fe357"}})).data["Time Series (Daily)"];return Object.keys(t).map(e=>({date:e,open:Number(t[e]["1. open"]),high:Number(t[e]["2. high"]),low:Number(t[e]["3. low"]),close:Number(t[e]["4. close"]),volume:Number(t[e]["5. volume"])}))}const ce=r=>{const{onSubmit:o}=r,[t,e]=h.exports.useState(v({},r==null?void 0:r.initValue)),[n,s]=h.exports.useState({}),i=x=>u=>{e(A(v({},t),{[x]:u}))},a=()=>{if(!t.stockCode){s({stockCode:"\u7DE8\u865F\u4E0D\u53EF\u70BA\u7A7A"});return}s({}),o&&o({stockCode:t.stockCode})};return C(B,{container:!0,spacing:2,children:[c(B,{item:!0,children:c(J,{size:"small",value:t.stockCode||"",onChange:x=>i("stockCode")(x.target.value),error:Boolean(n.stockCode),helperText:n.stockCode})}),c(B,{item:!0,children:c(Q,{variant:"contained",onClick:a,children:"\u67E5\u8A62"})})]})};const S=h.exports.createContext({width:0,height:0,xAxisTicks:[],xAxisFn:()=>0,yAxisTicks:[],yAxisFn:()=>0,xTickHeight:20,yTickWidth:30,onHoverItem:()=>{}}),V=r=>{const{width:o,height:t,xAxisTicks:e,yAxisTicks:n,yTickWidth:s=30,DivProps:i}=r,a=20,x=h.exports.useCallback(y=>{if(e.length===0)return 0;const f=(o-s-20)/(e.length-1);return s+e.findIndex(m=>m===y)*f},[e,o,s]),u=h.exports.useCallback(y=>{if(n.length===0)return 0;const m=t-a-10;if(typeof y=="number"&&typeof n[0]=="number"){const k=n[0],p=n[n.length-1];return(y-k)/(p-k)*m+10}const w=m/(n.length-1);return n.findIndex(k=>k===y)*w+10},[n,a,t]),[l,T]=h.exports.useState();return c(S.Provider,{value:{width:o,height:t,xAxisFn:x,xAxisTicks:e,yAxisFn:u,yAxisTicks:n,xTickHeight:a,yTickWidth:s,hoverItem:l,onHoverItem:T},children:c("div",A(v({},i),{className:"chart-root",style:A(v({},i==null?void 0:i.style),{width:o,height:t,cursor:(i==null?void 0:i.onMouseDown)?"grab":void 0}),children:c("svg",{viewBox:`0 0 ${o} ${t}`,children:r.children})}))})},ie=r=>{const{data:o,x:t,y:e,color:n}=r,{xAxisFn:s,yAxisFn:i,yAxisTicks:a,onHoverItem:x}=h.exports.useContext(S),u=i(a[a.length-1]),l=10,T=typeof n=="function"?n:()=>n;return c("g",{className:"line",children:o.map((y,f)=>c(N.Fragment,{children:c("rect",{x:s(y[t])-l/2,y:i(y[e]),width:l,height:u-i(y[e]),fill:T(y),onMouseEnter:m=>x({x:m.clientX,y:m.clientY,data:y}),onMouseLeave:()=>x()})},f))})},ae=r=>{const{maxTickCount:o=10,fontSize:t=8,label:e=l=>l.toString()}=r,{xAxisFn:n,yAxisFn:s,xAxisTicks:i,yAxisTicks:a,xTickHeight:x}=h.exports.useContext(S),u=Math.ceil(i.length/o);return c("g",{className:"xAxis",children:i.map((l,T)=>C(N.Fragment,{children:[c("line",{className:((i.length-T)%u).toString(),x1:n(l),y1:s(a[0]),x2:n(l),y2:s(a[a.length-1]),stroke:"#cfcfcf"}),(i.length-T+1)%u===0&&c("text",{className:"tick-text",fontSize:t,x:n(l)-20,y:s(a[a.length-1])+x/2,children:e(l)})]},l))})},P=r=>{const{maxTickCount:o=10,fontSize:t=8,label:e=u=>u.toString()}=r,{xAxisFn:n,yAxisFn:s,xAxisTicks:i,yAxisTicks:a,yTickWidth:x}=h.exports.useContext(S);return Math.ceil(a.length/o),c("g",{className:"yAxis",children:a.map((u,l)=>C(N.Fragment,{children:[c("line",{x1:n(i[0]),y1:s(u),x2:n(i[i.length-1]),y2:s(u),stroke:"#cfcfcf"},u),c("text",{className:"tick-text",fontSize:t,x:n(i[0])-x,y:s(u)+t/2,children:e(u)})]},u))})},q=r=>{const{render:o}=r,{hoverItem:t}=h.exports.useContext(S),e=h.exports.useRef(document.createElement("div"));return h.exports.useEffect(()=>(document.body.append(e.current),()=>{e.current}),[]),G.createPortal(c("div",{className:"tooltip",style:{top:t?t.y+24:void 0,left:t?t.x:void 0,display:t?void 0:"none"},children:(t==null?void 0:t.data)&&o(t.data)}),e.current)},ue=r=>{const{data:o,barWidth:t=10}=r,{xAxisFn:e,yAxisFn:n,yAxisTicks:s,onHoverItem:i}=h.exports.useContext(S);return n(s[s.length-1]),c("g",{className:"line",children:o.map((a,x)=>{const u=e(a.date),l=n(a.open),T=n(a.high),y=n(a.low),f=n(a.close),m=Math.min(l,f),w=Math.abs(l-f),k=a.close>=a.open?"green":"red";return C(N.Fragment,{children:[c("rect",{x:u-t/2,y:m,width:t,height:w,fill:k,onMouseEnter:p=>i({x:p.clientX,y:p.clientY,data:a}),onMouseLeave:()=>i()}),c("line",{x1:u,y1:T,x2:u,y2:y,stroke:k,strokeWidth:2})]},x)})})};function le({onZoomChange:r,delay:o=10}){const t=h.exports.useRef(),e=h.exports.useRef(0),n=s=>{e.current+=s.deltaY,t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{r(e.current),e.current=0},o)};return h.exports.useEffect(()=>()=>{t.current&&clearTimeout(t.current)},[]),{onWheel:n}}function de({onSwipe:r,delay:o=10}){const t=h.exports.useRef(0),e=h.exports.useRef(),n=f=>{t.current+=f,e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{r(t.current),t.current=0},o)};h.exports.useEffect(()=>()=>{e.current&&clearTimeout(e.current)},[]);const s=h.exports.useRef(!1),i=f=>{s.current=!0},a=f=>{s.current=!1},x=f=>{s.current=!1},u=f=>{!s.current||n(f.movementX)},l=h.exports.useRef();return{onMouseUp:a,onMouseDown:i,onMouseMove:u,onMouseLeave:x,onTouchMove:f=>{if(f.touches.length>1)return;l.current||(l.current=f.touches[0].screenX);const m=f.touches[0].screenX-l.current;l.current=f.touches[0].screenX,n(m)},onTouchEnd:f=>{l.current=null}}}const he=r=>{const{width:o,height:t,data:e,date:n,onDateChange:s,displayDay:i,onDisplayDayChange:a}=r,x=F(n).add(-i/2,"day").format("YYYY-MM-DD"),u=F(n).add(i/2,"day").format("YYYY-MM-DD"),l=h.exports.useMemo(()=>(e==null?void 0:e.filter(d=>{const g=F(d.date);return!g.isBefore(x)&&!g.isAfter(u)}))||[],[e,x,u]),T=h.exports.useMemo(()=>{const d=[];let g=F(x);for(;!g.isAfter(u);){const M=g.format("YYYY-MM-DD");(e==null?void 0:e.some(b=>b.date===M))&&d.push(M),g=g.add(1,"day")}return d},[x,u,e]),y=h.exports.useMemo(()=>{if(l.length===0)return[];const d=l.map(W=>[W.high,W.low]).flat(),g=Math.min(...d),M=Math.max(...d),b=M-g,Y=g-b*.2,D=M+b*.2,I=(D-Y)/5,H=[];let L=D;for(;L>=Y;)H.push(Math.round(L*100)/100),L-=I;return H},[l]),f=h.exports.useMemo(()=>{if(l.length===0)return[];const d=l.map(I=>I.volume),g=Math.round(Math.min(...d)*.1),M=Math.round(Math.max(...d)*1.1),b=Math.round((M-g)/5),Y=[];let D=M;for(;D>=g;)Y.push(D),D-=b;return Y},[l]),m=le({onZoomChange(d){const g=Math.min(Math.max(6,i+Math.round(d/20)),(e==null?void 0:e.length)||1/0);a&&a(g)}}),w=e==null?void 0:e[e.length-1].date,k=e==null?void 0:e[0].date,p=de({onSwipe(d){const g=Math.round(d/10),M=F(n).add(-g,"day");if(!M.isBefore(w)&&!M.isAfter(k)){s&&s(M.format("YYYY-MM-DD"));return}}});return C("div",{children:[C(V,{width:o,height:t/3*2,xAxisTicks:T,yAxisTicks:y,yTickWidth:30,DivProps:A(v(v({},m),p),{onTouchMove(d){(m==null?void 0:m.onTouchMove)&&(m==null||m.onTouchMove(d)),(p==null?void 0:p.onTouchMove)&&(p==null||p.onTouchMove(d))}}),children:[c(ae,{}),c(P,{label:d=>Number(d).toFixed(2)}),c(ue,{data:l}),c(q,{render:d=>c(z,{data:d})})]}),C(V,{width:o,height:t/3,xAxisTicks:T,yAxisTicks:f,yTickWidth:30,DivProps:A(v(v({},m),p),{onTouchMove(d){(m==null?void 0:m.onTouchMove)&&(m==null||m.onTouchMove(d)),(p==null?void 0:p.onTouchMove)&&(p==null||p.onTouchMove(d))}}),children:[c(P,{label:d=>ee(d).format("0 a")}),c(ie,{data:l,x:"date",y:"volume",color:d=>d.close>=d.open?"green":"red"}),c(q,{render:d=>c(z,{data:d})})]})]})},z=r=>{const{data:o}=r;return C("div",{children:[c("div",{children:`Date: ${o.date}`}),c("div",{children:`Open: ${o.open}`}),c("div",{children:`High: ${o.high}`}),c("div",{children:`Low: ${o.low}`}),c("div",{children:`Close: ${o.close}`}),c("div",{children:`Volume: ${o.volume}`})]})},xe=t=>{var e=t,{render:r}=e,o=j(e,["render"]);const n=h.exports.useRef(null),[s,i]=h.exports.useState({width:0,height:0});return h.exports.useEffect(()=>{const a=()=>{var u;console.log("resize");const x=(u=n.current)==null?void 0:u.getBoundingClientRect();x&&i({height:x.height,width:x.width})};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),c("div",A(v({ref:n},o),{children:r(s)}))},me=r=>{const[o,t]=h.exports.useState("AAPL"),[e,n]=h.exports.useState("2022-01-01"),[s,i]=h.exports.useState(30),{data:a}=te(o,u=>u?se(u):null);return c(ne,{children:C(oe,{children:[c(O,{children:c(ce,{initValue:{stockCode:o},onSubmit:u=>{t(u.stockCode)}})}),c(O,{children:a?c(xe,{style:{width:"100%",height:400},render:({width:u,height:l})=>c(he,{height:l,width:u,data:a,date:e,onDateChange:n,displayDay:s,onDisplayDayChange:i})}):"loading..."})]})})},fe=r=>c(me,{});G.render(c(N.StrictMode,{children:c(fe,{})}),document.getElementById("root"));
