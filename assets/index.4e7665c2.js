var Z=Object.defineProperty,_=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var E=(r,o,e)=>o in r?Z(r,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[o]=e,v=(r,o)=>{for(var e in o||(o={}))$.call(o,e)&&E(r,e,o[e]);if(L)for(var e of L(o))j.call(o,e)&&E(r,e,o[e]);return r},A=(r,o)=>_(r,U(o));var O=(r,o)=>{var e={};for(var t in r)$.call(r,t)&&o.indexOf(t)<0&&(e[t]=r[t]);if(r!=null&&L)for(var t of L(r))o.indexOf(t)<0&&j.call(r,t)&&(e[t]=r[t]);return e};import{a as J,r as d,j as C,G as W,b as s,T as Q,B as ee,R,c as K,d as Y,n as te,u as ne,C as oe,e as re,f as V}from"./vendor.ffc94ebc.js";const se=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerpolicy&&(c.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?c.credentials="include":n.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function t(n){if(n.ep)return;n.ep=!0;const c=e(n);fetch(n.href,c)}};se();async function ce(r){const e=(await J.request({method:"GET",url:"https://alpha-vantage.p.rapidapi.com/query",params:{function:"TIME_SERIES_DAILY",symbol:r,outputsize:"compact",datatype:"json"},headers:{"x-rapidapi-host":"alpha-vantage.p.rapidapi.com","x-rapidapi-key":"25736f6270msh628d56ffab28607p1deb15jsnf857454fe357"}})).data["Time Series (Daily)"];return Object.keys(e).map(t=>({date:t,open:Number(e[t]["1. open"]),high:Number(e[t]["2. high"]),low:Number(e[t]["3. low"]),close:Number(e[t]["4. close"]),volume:Number(e[t]["5. volume"])}))}const ie=r=>{const{onSubmit:o}=r,[e,t]=d.exports.useState(v({},r==null?void 0:r.initValue)),[n,c]=d.exports.useState({}),a=m=>i=>{t(A(v({},e),{[m]:i}))},l=()=>{if(!e.stockCode){c({stockCode:"\u7DE8\u865F\u4E0D\u53EF\u70BA\u7A7A"});return}c({}),o&&o({stockCode:e.stockCode})};return C(W,{container:!0,spacing:2,children:[s(W,{item:!0,children:s(Q,{size:"small",value:e.stockCode||"",onChange:m=>a("stockCode")(m.target.value),error:Boolean(n.stockCode),helperText:n.stockCode})}),s(W,{item:!0,children:s(ee,{variant:"contained",onClick:l,children:"\u67E5\u8A62"})})]})};const w=d.exports.createContext({width:0,height:0,xAxisTicks:[],xAxisFn:()=>0,yAxisTicks:[],yAxisFn:()=>0,xTickHeight:20,yTickWidth:30,onHoverItem:()=>{}}),P=r=>{const{width:o,height:e,xAxisTicks:t,yAxisTicks:n,yTickWidth:c=30,DivProps:a}=r,l=20,m=d.exports.useCallback(x=>{if(t.length===0)return 0;const T=(o-c-20)/(t.length-1);return c+t.findIndex(f=>f===x)*T},[t,o,c]),i=d.exports.useCallback(x=>{if(n.length===0)return 0;const f=e-l-10;if(typeof x=="number"&&typeof n[0]=="number"){const k=n[0],D=n[n.length-1];return(x-k)/(D-k)*f+10}const F=f/(n.length-1);return n.findIndex(k=>k===x)*F+10},[n,l,e]),[h,y]=d.exports.useState();return s(w.Provider,{value:{width:o,height:e,xAxisFn:m,xAxisTicks:t,yAxisFn:i,yAxisTicks:n,xTickHeight:l,yTickWidth:c,hoverItem:h,onHoverItem:y},children:s("div",A(v({},a),{className:"chart-root",style:A(v({},a==null?void 0:a.style),{width:o,height:e,cursor:(a==null?void 0:a.onMouseDown)?"grab":void 0}),children:s("svg",{viewBox:`0 0 ${o} ${e}`,children:r.children})}))})},ae=r=>{const{data:o,x:e,y:t,color:n}=r,{xAxisFn:c,yAxisFn:a,yAxisTicks:l,onHoverItem:m}=d.exports.useContext(w),i=a(l[l.length-1]),h=10,y=typeof n=="function"?n:()=>n;return s("g",{className:"line",children:o.map((x,T)=>s(R.Fragment,{children:s("rect",{x:c(x[e])-h/2,y:a(x[t]),width:h,height:i-a(x[t]),fill:y(x),onMouseEnter:f=>m({x:f.clientX,y:f.clientY,data:x}),onMouseLeave:()=>m()})},T))})},le=r=>{const{maxTickCount:o=10,fontSize:e=8,label:t=h=>h.toString()}=r,{xAxisFn:n,yAxisFn:c,xAxisTicks:a,yAxisTicks:l,xTickHeight:m}=d.exports.useContext(w),i=Math.ceil(a.length/o);return s("g",{className:"xAxis",children:a.map((h,y)=>C(R.Fragment,{children:[s("line",{className:((a.length-y)%i).toString(),x1:n(h),y1:c(l[0]),x2:n(h),y2:c(l[l.length-1]),stroke:"#cfcfcf"}),(a.length-y+1)%i===0&&s("text",{className:"tick-text",fontSize:e,x:n(h)-20,y:c(l[l.length-1])+m/2,children:t(h)})]},h))})},q=r=>{const{maxTickCount:o=10,fontSize:e=8,label:t=i=>i.toString()}=r,{xAxisFn:n,yAxisFn:c,xAxisTicks:a,yAxisTicks:l,yTickWidth:m}=d.exports.useContext(w);return Math.ceil(l.length/o),s("g",{className:"yAxis",children:l.map((i,h)=>C(R.Fragment,{children:[s("line",{x1:n(a[0]),y1:c(i),x2:n(a[a.length-1]),y2:c(i),stroke:"#cfcfcf"},i),s("text",{className:"tick-text",fontSize:e,x:n(a[0])-m,y:c(i)+e/2,children:t(i)})]},i))})},z=r=>{const{render:o}=r,{hoverItem:e}=d.exports.useContext(w),t=d.exports.useRef(document.createElement("div"));return d.exports.useEffect(()=>(document.body.append(t.current),()=>{t.current}),[]),K.createPortal(s("div",{className:"tooltip",style:{top:e?e.y+24:void 0,left:e?e.x:void 0,display:e?void 0:"none"},children:(e==null?void 0:e.data)&&o(e.data)}),t.current)},ue=r=>{const{data:o,barWidth:e=10}=r,{xAxisFn:t,yAxisFn:n,yAxisTicks:c,onHoverItem:a}=d.exports.useContext(w);return n(c[c.length-1]),s("g",{className:"line",children:o.map((l,m)=>{const i=t(l.date),h=n(l.open),y=n(l.high),x=n(l.low),T=n(l.close),f=Math.min(h,T),F=Math.abs(h-T),k=l.close>=l.open?"green":"red";return C(R.Fragment,{children:[s("rect",{x:i-e/2,y:f,width:e,height:F,fill:k,onMouseEnter:D=>a({x:D.clientX,y:D.clientY,data:l}),onMouseLeave:()=>a()}),s("line",{x1:i,y1:y,x2:i,y2:x,stroke:k,strokeWidth:2})]},m)})})};function de({onZoomChange:r,delay:o=10}){const e=d.exports.useRef(),t=d.exports.useRef(0),n=c=>{t.current+=c.deltaY,e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{r(t.current),t.current=0},o)};return d.exports.useEffect(()=>()=>{e.current&&clearTimeout(e.current)},[]),{onWheel:n}}function he({onSwipe:r,threshold:o}){const e=d.exports.useRef(0),t=x=>{e.current+=x,Math.abs(e.current)>o&&(r(e.current),e.current=0)},n=d.exports.useRef(!1),c=x=>{n.current=!0,e.current=0},a=x=>{n.current=!1},l=x=>{n.current=!1},m=x=>{!n.current||t(x.movementX)},i=d.exports.useRef();return{onMouseUp:a,onMouseDown:c,onMouseMove:m,onMouseLeave:l,onTouchMove:x=>{if(x.touches.length>1)return;i.current||(i.current=x.touches[0].screenX);const T=x.touches[0].screenX-i.current;i.current=x.touches[0].screenX,t(T)},onTouchEnd:x=>{i.current=null}}}const xe=r=>{const{width:o,height:e,data:t,date:n,onDateChange:c,displayDay:a,onDisplayDayChange:l}=r,m=Y(n).add(-a/2,"day").format("YYYY-MM-DD"),i=Y(n).add(a/2,"day").format("YYYY-MM-DD"),h=d.exports.useMemo(()=>(t==null?void 0:t.filter(u=>{const p=Y(u.date);return!p.isBefore(m)&&!p.isAfter(i)}))||[],[t,m,i]),y=d.exports.useMemo(()=>{const u=[];let p=Y(m);for(;!p.isAfter(i);){const M=p.format("YYYY-MM-DD");(t==null?void 0:t.some(b=>b.date===M))&&u.push(M),p=p.add(1,"day")}return u},[m,i,t]),x=d.exports.useMemo(()=>{if(h.length===0)return[];const u=h.map(X=>[X.high,X.low]).flat(),p=Math.min(...u),M=Math.max(...u),b=M-p,N=p-b*.4,S=M+b*.4,B=(S-N)/5,H=[];let I=S;for(;I>=N;)H.push(Math.round(I*100)/100),I-=B;return H.push(Math.round(I*100)/100),H},[h]),T=d.exports.useMemo(()=>{if(h.length===0)return[];const u=h.map(B=>B.volume),p=Math.round(Math.min(...u)*.1),M=Math.round(Math.max(...u)*1.1),b=Math.round((M-p)/5),N=[];let S=M;for(;S>=p;)N.push(S),S-=b;return N},[h]),f=de({onZoomChange(u){const p=Math.min(Math.max(6,a+Math.round(u/20)),(t==null?void 0:t.length)||1/0);l&&l(p)}}),F=t==null?void 0:t[t.length-1].date,k=t==null?void 0:t[0].date,D=o/a,g=he({onSwipe(u){const p=Math.round(u/10),M=Y(n).add(-p,"day");if(!M.isBefore(F)&&!M.isAfter(k)){c&&c(M.format("YYYY-MM-DD"));return}},threshold:D});return C("div",{children:[C(P,{width:o,height:e/3*2,xAxisTicks:y,yAxisTicks:x,yTickWidth:30,DivProps:A(v(v({},f),g),{onTouchMove(u){(f==null?void 0:f.onTouchMove)&&(f==null||f.onTouchMove(u)),(g==null?void 0:g.onTouchMove)&&(g==null||g.onTouchMove(u))}}),children:[s(le,{}),s(q,{label:u=>Number(u).toFixed(2)}),s(ue,{data:h}),s(z,{render:u=>s(G,{data:u})})]}),C(P,{width:o,height:e/3,xAxisTicks:y,yAxisTicks:T,yTickWidth:30,DivProps:A(v(v({},f),g),{onTouchMove(u){(f==null?void 0:f.onTouchMove)&&(f==null||f.onTouchMove(u)),(g==null?void 0:g.onTouchMove)&&(g==null||g.onTouchMove(u))}}),children:[s(q,{label:u=>te(u).format("0 a")}),s(ae,{data:h,x:"date",y:"volume",color:u=>u.close>=u.open?"green":"red"}),s(z,{render:u=>s(G,{data:u})})]})]})},G=r=>{const{data:o}=r;return C("div",{children:[s("div",{children:`Date: ${o.date}`}),s("div",{children:`Open: ${o.open}`}),s("div",{children:`High: ${o.high}`}),s("div",{children:`Low: ${o.low}`}),s("div",{children:`Close: ${o.close}`}),s("div",{children:`Volume: ${o.volume}`})]})},me=e=>{var t=e,{render:r}=t,o=O(t,["render"]);const n=d.exports.useRef(null),[c,a]=d.exports.useState({width:0,height:0});return d.exports.useEffect(()=>{const l=()=>{var i;console.log("resize");const m=(i=n.current)==null?void 0:i.getBoundingClientRect();m&&a({height:m.height,width:m.width})};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),s("div",A(v({ref:n},o),{children:r(c)}))},fe=r=>{const[o,e]=d.exports.useState("AAPL"),[t,n]=d.exports.useState(Y().format("YYYY-MM-DD")),[c,a]=d.exports.useState(30),{data:l}=ne(o,i=>i?ce(i):null);return s(oe,{children:C(re,{children:[s(V,{children:s(ie,{initValue:{stockCode:o},onSubmit:i=>{e(i.stockCode)}})}),s(V,{children:l?s(me,{style:{width:"100%",height:400},render:({width:i,height:h})=>s(xe,{height:h,width:i,data:l,date:t,onDateChange:n,displayDay:c,onDisplayDayChange:a})}):"loading..."})]})})},pe=r=>s(fe,{});K.render(s(R.StrictMode,{children:s(pe,{})}),document.getElementById("root"));
